{% extends "base.html" %}

{% block title %}Driver Analysis - F1 Analytics{% endblock %}

{% block content %}
<div class="container">
    <!-- Page Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="section-header">
                <h1 class="section-title">
                    <i class="bi bi-person-circle text-ferrari me-3"></i>
                    Driver Performance Analysis
                </h1>
                <p class="section-subtitle">Individual driver statistics, career progression, and competitive metrics</p>
            </div>
        </div>
    </div>

    <!-- Driver Selector -->
    <div class="row mb-4">
        <div class="col-lg-8 mx-auto">
            <div class="card">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-md-3">
                            <label for="driverSelect" class="form-label">Select Driver</label>
                        </div>
                        <div class="col-md-7">
                            <select class="form-select" id="driverSelect">
                                <option selected>Max Verstappen</option>
                                <option>Lewis Hamilton</option>
                                <option>Charles Leclerc</option>
                                <option>Lando Norris</option>
                                <option>Fernando Alonso</option>
                                <option>Sebastian Vettel</option>
                                <option>Michael Schumacher</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <button class="btn btn-primary w-100" id="loadDriver">
                                <i class="bi bi-search me-1"></i>Load
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Driver Stats Cards -->
    <div class="row g-4 mb-5">
        <div class="col-md-6 col-lg-3">
            <div class="card text-center h-100">
                <div class="card-body">
                    <i class="bi bi-trophy-fill text-gold" style="font-size: 2.5rem;"></i>
                    <h3 class="text-gold mt-3 mb-1">53</h3>
                    <p class="text-muted mb-0">Career Wins</p>
                </div>
            </div>
        </div>
        <div class="col-md-6 col-lg-3">
            <div class="card text-center h-100">
                <div class="card-body">
                    <i class="bi bi-award-fill text-ferrari" style="font-size: 2.5rem;"></i>
                    <h3 class="text-ferrari mt-3 mb-1">98</h3>
                    <p class="text-muted mb-0">Podium Finishes</p>
                </div>
            </div>
        </div>
        <div class="col-md-6 col-lg-3">
            <div class="card text-center h-100">
                <div class="card-body">
                    <i class="bi bi-speedometer text-positive" style="font-size: 2.5rem;"></i>
                    <h3 class="text-positive mt-3 mb-1">25</h3>
                    <p class="text-muted mb-0">Pole Positions</p>
                </div>
            </div>
        </div>
        <div class="col-md-6 col-lg-3">
            <div class="card text-center h-100">
                <div class="card-body">
                    <i class="bi bi-star-fill" style="font-size: 2.5rem; color: #1F6AE1;"></i>
                    <h3 style="color: #1F6AE1;" class="mt-3 mb-1">3</h3>
                    <p class="text-muted mb-0">Championships</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Wins per Season -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="chart-container">
                <h3 class="chart-title">
                    <i class="bi bi-graph-up-arrow"></i>
                    Wins per Season
                </h3>
                <div id="winsPerSeasonChart"></div>
                <div class="chart-insight">
                    <p>
                        <strong>Analysis:</strong> Max Verstappen showed consistent performance growth from 
                        2016 onwards, with a breakthrough in 2021 (10 wins) and dominant performances in 
                        2022 (15 wins) and 2023 (19 wins), showcasing his evolution into championship form.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Podium Consistency & Points Progression -->
    <div class="row mb-4">
        <div class="col-lg-6 mb-4 mb-lg-0">
            <div class="chart-container h-100">
                <h3 class="chart-title">
                    <i class="bi bi-bar-chart-fill"></i>
                    Podium Rate by Season
                </h3>
                <div id="podiumRateChart"></div>
                <div class="chart-insight">
                    <p>
                        <strong>Insight:</strong> Verstappen's podium percentage has increased dramatically, 
                        reaching over 90% in championship-winning seasons, indicating elite consistency.
                    </p>
                </div>
            </div>
        </div>
        <div class="col-lg-6">
            <div class="chart-container h-100">
                <h3 class="chart-title">
                    <i class="bi bi-graph-up"></i>
                    Points Progression
                </h3>
                <div id="pointsProgressionChart"></div>
                <div class="chart-insight">
                    <p>
                        <strong>Trend:</strong> Career points accumulation shows exponential growth post-2020, 
                        correlating with Red Bull's technical dominance and driver maturity.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Career Longevity & Race Participation -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="chart-container">
                <h3 class="chart-title">
                    <i class="bi bi-calendar-check"></i>
                    Career Timeline & Race Participation
                </h3>
                <div id="careerTimelineChart"></div>
                <div class="chart-insight">
                    <p>
                        <strong>Career Overview:</strong> Active since 2015, Verstappen has competed in over 
                        180 Grands Prix, making him one of the most experienced drivers in the current grid 
                        despite his relatively young age.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Head-to-Head Comparison -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <i class="bi bi-people-fill me-2"></i>Head-to-Head Comparison
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label for="compareDriver" class="form-label">Compare with</label>
                            <select class="form-select" id="compareDriver">
                                <option selected>Lewis Hamilton</option>
                                <option>Charles Leclerc</option>
                                <option>Fernando Alonso</option>
                                <option>Sebastian Vettel</option>
                            </select>
                        </div>
                        <div class="col-md-8">
                            <div id="comparisonChart"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Performance Metrics Table -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <i class="bi bi-table me-2"></i>Detailed Performance Metrics
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-dark table-hover">
                            <thead>
                                <tr>
                                    <th>Metric</th>
                                    <th>Value</th>
                                    <th>Rank (All-Time)</th>
                                    <th>Percentile</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Win Percentage</td>
                                    <td class="text-positive">29.4%</td>
                                    <td>#8</td>
                                    <td><span class="badge badge-gold">Top 1%</span></td>
                                </tr>
                                <tr>
                                    <td>Podium Percentage</td>
                                    <td class="text-positive">54.4%</td>
                                    <td>#4</td>
                                    <td><span class="badge badge-gold">Top 1%</span></td>
                                </tr>
                                <tr>
                                    <td>Points per Race</td>
                                    <td class="text-positive">14.8</td>
                                    <td>#3</td>
                                    <td><span class="badge badge-gold">Top 1%</span></td>
                                </tr>
                                <tr>
                                    <td>Avg. Finish Position</td>
                                    <td class="text-positive">3.2</td>
                                    <td>#5</td>
                                    <td><span class="badge badge-gold">Top 1%</span></td>
                                </tr>
                                <tr>
                                    <td>DNF Rate</td>
                                    <td class="text-ferrari">12.7%</td>
                                    <td>#142</td>
                                    <td><span class="badge badge-positive">Better than 75%</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Wins per Season
    var winsData = {
        x: [2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023],
        y: [1, 2, 2, 3, 2, 10, 15, 19],
        type: 'bar',
        marker: {color: '#E10600'}
    };

    Plotly.newPlot('winsPerSeasonChart', [winsData], {
        template: 'plotly_dark',
        paper_bgcolor: '#161A20',
        plot_bgcolor: '#0F1115',
        font: {color: '#EAEAEA'},
        xaxis: {title: 'Season'},
        yaxis: {title: 'Number of Wins'},
        hovermode: 'x unified'
    }, {responsive: true});

    // Podium Rate
    var podiumData = {
        x: [2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023],
        y: [15, 25, 35, 42, 48, 78, 91, 95],
        type: 'scatter',
        mode: 'lines+markers',
        line: {color: '#F5C542', width: 3},
        marker: {size: 8}
    };

    Plotly.newPlot('podiumRateChart', [podiumData], {
        template: 'plotly_dark',
        paper_bgcolor: '#161A20',
        plot_bgcolor: '#0F1115',
        font: {color: '#EAEAEA'},
        xaxis: {title: 'Season'},
        yaxis: {title: 'Podium Rate (%)', range: [0, 100]},
        hovermode: 'x unified'
    }, {responsive: true});

    // Points Progression (Cumulative)
    var pointsData = {
        x: [2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023],
        y: [204, 372, 621, 899, 1113, 1508, 2067, 2642],
        type: 'scatter',
        mode: 'lines+markers',
        fill: 'tozeroy',
        line: {color: '#2ECC71', width: 2},
        marker: {size: 6}
    };

    Plotly.newPlot('pointsProgressionChart', [pointsData], {
        template: 'plotly_dark',
        paper_bgcolor: '#161A20',
        plot_bgcolor: '#0F1115',
        font: {color: '#EAEAEA'},
        xaxis: {title: 'Season'},
        yaxis: {title: 'Cumulative Points'},
        hovermode: 'x unified'
    }, {responsive: true});

    // Career Timeline
    var timelineData = {
        x: [2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023],
        y: [21, 20, 21, 21, 17, 22, 22, 22],
        type: 'bar',
        marker: {color: '#1F6AE1'}
    };

    Plotly.newPlot('careerTimelineChart', [timelineData], {
        template: 'plotly_dark',
        paper_bgcolor: '#161A20',
        plot_bgcolor: '#0F1115',
        font: {color: '#EAEAEA'},
        xaxis: {title: 'Season'},
        yaxis: {title: 'Races Participated'},
        hovermode: 'x unified'
    }, {responsive: true});

    // Comparison Chart
    var comparisonData = [
        {
            x: ['Wins', 'Podiums', 'Poles', 'Championships'],
            y: [53, 98, 25, 3],
            name: 'Max Verstappen',
            type: 'bar',
            marker: {color: '#E10600'}
        },
        {
            x: ['Wins', 'Podiums', 'Poles', 'Championships'],
            y: [103, 197, 104, 7],
            name: 'Lewis Hamilton',
            type: 'bar',
            marker: {color: '#00D2BE'}
        }
    ];

    Plotly.newPlot('comparisonChart', comparisonData, {
        template: 'plotly_dark',
        paper_bgcolor: '#161A20',
        plot_bgcolor: '#0F1115',
        font: {color: '#EAEAEA'},
        barmode: 'group',
        yaxis: {title: 'Count'},
        hovermode: 'x unified',
        height: 300
    }, {responsive: true});
</script>
{% endblock %}
