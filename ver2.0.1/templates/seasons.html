{% extends "base.html" %}

{% block title %}Circuit Analysis - F1 Analytics{% endblock %}

{% block content %}
<div class="container">
    <!-- Page Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="section-header">
                <h1 class="section-title">
                    <i class="bi bi-geo-alt-fill text-ferrari me-3"></i>
                    Circuit & Race Analysis
                </h1>
                <p class="section-subtitle">Track characteristics, lap time trends, and circuit-specific patterns</p>
            </div>
        </div>
    </div>

    <!-- Circuit Selector -->
    <div class="row mb-4">
        <div class="col-lg-8 mx-auto">
            <div class="card">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-md-3">
                            <label for="circuitSelect" class="form-label">Select Circuit</label>
                        </div>
                        <div class="col-md-7">
                            <select class="form-select" id="circuitSelect">
                                <option selected>Monaco - Circuit de Monaco</option>
                                <option>Silverstone - British GP</option>
                                <option>Monza - Italian GP</option>
                                <option>Spa-Francorchamps - Belgian GP</option>
                                <option>Suzuka - Japanese GP</option>
                                <option>Interlagos - Brazilian GP</option>
                                <option>Circuit of the Americas - USA</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <button class="btn btn-primary w-100" id="loadCircuit">
                                <i class="bi bi-search me-1"></i>Load
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Circuit Stats Cards -->
    <div class="row g-4 mb-5">
        <div class="col-md-6 col-lg-3">
            <div class="card text-center h-100">
                <div class="card-body">
                    <i class="bi bi-rulers text-gold" style="font-size: 2.5rem;"></i>
                    <h3 class="text-gold mt-3 mb-1">3.337</h3>
                    <p class="text-muted mb-0">Circuit Length (km)</p>
                </div>
            </div>
        </div>
        <div class="col-md-6 col-lg-3">
            <div class="card text-center h-100">
                <div class="card-body">
                    <i class="bi bi-sign-turn-right text-ferrari" style="font-size: 2.5rem;"></i>
                    <h3 class="text-ferrari mt-3 mb-1">19</h3>
                    <p class="text-muted mb-0">Number of Corners</p>
                </div>
            </div>
        </div>
        <div class="col-md-6 col-lg-3">
            <div class="card text-center h-100">
                <div class="card-body">
                    <i class="bi bi-speedometer text-positive" style="font-size: 2.5rem;"></i>
                    <h3 class="text-positive mt-3 mb-1">260</h3>
                    <p class="text-muted mb-0">Top Speed (km/h)</p>
                </div>
            </div>
        </div>
        <div class="col-md-6 col-lg-3">
            <div class="card text-center h-100">
                <div class="card-body">
                    <i class="bi bi-calendar-range" style="font-size: 2.5rem; color: #1F6AE1;"></i>
                    <h3 style="color: #1F6AE1;" class="mt-3 mb-1">68</h3>
                    <p class="text-muted mb-0">Times Hosted</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Circuit Usage Over Time -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="chart-container">
                <h3 class="chart-title">
                    <i class="bi bi-graph-up"></i>
                    Most Used Circuits in F1 History
                </h3>
                <div id="circuitUsageChart"></div>
                <div class="chart-insight">
                    <p>
                        <strong>Historical Significance:</strong> Monaco, Monza, and Silverstone are the most 
                        frequently used circuits, having hosted races nearly every year since the championship 
                        began. These iconic venues represent the heritage and tradition of Formula 1.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Lap Time Evolution -->
    <div class="row mb-4">
        <div class="col-lg-6 mb-4 mb-lg-0">
            <div class="chart-container h-100">
                <h3 class="chart-title">
                    <i class="bi bi-clock-history"></i>
                    Average Lap Time Evolution
                </h3>
                <div id="lapTimeChart"></div>
                <div class="chart-insight">
                    <p>
                        <strong>Technical Progress:</strong> Lap times at Monaco have decreased by approximately 
                        8 seconds over the past 30 years, reflecting advances in aerodynamics, power units, and tire technology.
                    </p>
                </div>
            </div>
        </div>
        <div class="col-lg-6">
            <div class="chart-container h-100">
                <h3 class="chart-title">
                    <i class="bi bi-stopwatch"></i>
                    Fastest Lap Progression
                </h3>
                <div id="fastestLapChart"></div>
                <div class="chart-insight">
                    <p>
                        <strong>Current Record:</strong> Lewis Hamilton holds the fastest lap at Monaco (1:10.166) 
                        set in 2021, showcasing the peak performance capabilities of modern F1 cars.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Pit Stop Analysis -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="chart-container">
                <h3 class="chart-title">
                    <i class="bi bi-tools"></i>
                    Pit Stop Duration Trends
                </h3>
                <div id="pitStopChart"></div>
                <div class="chart-insight">
                    <p>
                        <strong>Operational Excellence:</strong> Average pit stop times have improved from 
                        4-5 seconds in the 2010s to consistent sub-2.5 second stops in recent years, with 
                        Red Bull Racing holding multiple records for fastest stops under 2 seconds.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Circuit Characteristics -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <i class="bi bi-info-circle me-2"></i>Circuit Characteristics & Statistics
                </div>
                <div class="card-body">
                    <div class="row g-4">
                        <div class="col-md-6">
                            <h6 class="text-ferrari mb-3">Track Profile</h6>
                            <ul class="list-unstyled">
                                <li class="mb-2">
                                    <strong class="text-gold">Type:</strong> 
                                    <span class="text-secondary">Street Circuit</span>
                                </li>
                                <li class="mb-2">
                                    <strong class="text-gold">Direction:</strong> 
                                    <span class="text-secondary">Clockwise</span>
                                </li>
                                <li class="mb-2">
                                    <strong class="text-gold">Lap Record:</strong> 
                                    <span class="text-secondary">1:10.166 (Lewis Hamilton, 2021)</span>
                                </li>
                                <li class="mb-2">
                                    <strong class="text-gold">Race Distance:</strong> 
                                    <span class="text-secondary">260.286 km (78 laps)</span>
                                </li>
                                <li class="mb-2">
                                    <strong class="text-gold">DRS Zones:</strong> 
                                    <span class="text-secondary">1 zone</span>
                                </li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6 class="text-ferrari mb-3">Race Characteristics</h6>
                            <ul class="list-unstyled">
                                <li class="mb-2">
                                    <i class="bi bi-exclamation-triangle-fill text-gold me-2"></i>
                                    <strong>Overtaking Difficulty:</strong> Very High
                                </li>
                                <li class="mb-2">
                                    <i class="bi bi-droplet-fill" style="color: #1F6AE1;" class="me-2"></i>
                                    <strong>Weather Impact:</strong> Moderate (Rain common)
                                </li>
                                <li class="mb-2">
                                    <i class="bi bi-hammer text-ferrari me-2"></i>
                                    <strong>Barrier Contact Risk:</strong> Very High
                                </li>
                                <li class="mb-2">
                                    <i class="bi bi-flag-fill text-positive me-2"></i>
                                    <strong>Safety Car Probability:</strong> 65%
                                </li>
                                <li class="mb-2">
                                    <i class="bi bi-trophy text-gold me-2"></i>
                                    <strong>Prestige Level:</strong> Maximum (Crown Jewel)
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Overtaking Analysis -->
    <div class="row mb-4">
        <div class="col-lg-6 mb-4 mb-lg-0">
            <div class="card h-100">
                <div class="card-header">
                    <i class="bi bi-arrows-move me-2"></i>Overtaking Metrics
                </div>
                <div class="card-body">
                    <div id="overtakingChart"></div>
                    <div class="mt-3">
                        <p class="text-muted small mb-0">
                            <strong>Analysis:</strong> Monaco consistently ranks as one of the most difficult 
                            circuits for overtaking, with an average of only 5-8 on-track passes per race. 
                            Qualifying position is crucial for race outcome.
                        </p>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-6">
            <div class="card h-100">
                <div class="card-header">
                    <i class="bi bi-trophy-fill me-2"></i>Most Successful Drivers at Monaco
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-dark table-hover table-sm">
                            <thead>
                                <tr>
                                    <th>Rank</th>
                                    <th>Driver</th>
                                    <th>Wins</th>
                                    <th>Podiums</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><span class="badge badge-gold">1</span></td>
                                    <td>Ayrton Senna</td>
                                    <td class="text-gold">6</td>
                                    <td>8</td>
                                </tr>
                                <tr>
                                    <td><span class="badge" style="background: silver;">2</span></td>
                                    <td>Graham Hill</td>
                                    <td class="text-gold">5</td>
                                    <td>7</td>
                                </tr>
                                <tr>
                                    <td><span class="badge" style="background: #CD7F32;">3</span></td>
                                    <td>Michael Schumacher</td>
                                    <td class="text-gold">5</td>
                                    <td>8</td>
                                </tr>
                                <tr>
                                    <td>4</td>
                                    <td>Alain Prost</td>
                                    <td class="text-positive">4</td>
                                    <td>9</td>
                                </tr>
                                <tr>
                                    <td>5</td>
                                    <td>Lewis Hamilton</td>
                                    <td class="text-positive">3</td>
                                    <td>7</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Weather Impact Analysis -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <i class="bi bi-cloud-rain me-2"></i>Weather Impact on Race Outcomes
                </div>
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <div id="weatherImpactChart"></div>
                        </div>
                        <div class="col-md-4">
                            <h6 class="text-ferrari mb-3">Key Findings</h6>
                            <ul class="list-unstyled">
                                <li class="mb-2">
                                    <i class="bi bi-check-circle-fill text-positive me-2"></i>
                                    73% of races held in dry conditions
                                </li>
                                <li class="mb-2">
                                    <i class="bi bi-check-circle-fill text-gold me-2"></i>
                                    18% affected by rain (mixed conditions)
                                </li>
                                <li class="mb-2">
                                    <i class="bi bi-check-circle-fill text-ferrari me-2"></i>
                                    9% fully wet races
                                </li>
                                <li class="mb-2">
                                    <i class="bi bi-exclamation-triangle-fill" style="color: #1F6AE1;" class="me-2"></i>
                                    Wet races show 3x higher safety car deployment
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Circuit Usage
    var circuitData = {
        y: ['Monaco', 'Monza', 'Silverstone', 'Spa', 'Interlagos', 'NÃ¼rburgring', 'Suzuka', 'Montreal'],
        x: [68, 72, 76, 61, 49, 48, 36, 43],
        type: 'bar',
        orientation: 'h',
        marker: {color: '#E10600'}
    };

    Plotly.newPlot('circuitUsageChart', [circuitData], {
        template: 'plotly_dark',
        paper_bgcolor: '#161A20',
        plot_bgcolor: '#0F1115',
        font: {color: '#EAEAEA'},
        xaxis: {title: 'Number of Races Hosted'},
        yaxis: {title: ''},
        margin: {l: 120}
    }, {responsive: true});

    // Lap Time Evolution (in seconds)
    var lapTimeData = {
        x: [1990, 1995, 2000, 2005, 2010, 2015, 2020, 2023],
        y: [85.4, 83.2, 81.5, 79.8, 77.2, 75.1, 72.9, 71.2],
        type: 'scatter',
        mode: 'lines+markers',
        line: {color: '#F5C542', width: 3},
        marker: {size: 8}
    };

    Plotly.newPlot('lapTimeChart', [lapTimeData], {
        template: 'plotly_dark',
        paper_bgcolor: '#161A20',
        plot_bgcolor: '#0F1115',
        font: {color: '#EAEAEA'},
        xaxis: {title: 'Year'},
        yaxis: {title: 'Average Lap Time (seconds)'},
        hovermode: 'x unified'
    }, {responsive: true});

    // Fastest Lap Progression
    var fastestData = {
        x: [1990, 1995, 2000, 2005, 2010, 2015, 2020, 2021],
        y: [82.1, 79.8, 77.4, 75.2, 73.8, 72.1, 70.9, 70.166],
        type: 'scatter',
        mode: 'lines+markers',
        line: {color: '#2ECC71', width: 3},
        marker: {size: 8},
        fill: 'tozeroy',
        fillcolor: 'rgba(46, 204, 113, 0.1)'
    };

    Plotly.newPlot('fastestLapChart', [fastestData], {
        template: 'plotly_dark',
        paper_bgcolor: '#161A20',
        plot_bgcolor: '#0F1115',
        font: {color: '#EAEAEA'},
        xaxis: {title: 'Year'},
        yaxis: {title: 'Fastest Lap (seconds)'},
        hovermode: 'x unified'
    }, {responsive: true});

    // Pit Stop Duration
    var pitStopData = {
        x: [2010, 2012, 2014, 2016, 2018, 2020, 2022, 2023],
        y: [4.8, 4.2, 3.5, 2.9, 2.4, 2.3, 2.2, 2.1],
        type: 'bar',
        marker: {
            color: [4.8, 4.2, 3.5, 2.9, 2.4, 2.3, 2.2, 2.1],
            colorscale: [
                [0, '#2ECC71'],
                [1, '#E74C3C']
            ],
            reversescale: true
        }
    };

    Plotly.newPlot('pitStopChart', [pitStopData], {
        template: 'plotly_dark',
        paper_bgcolor: '#161A20',
        plot_bgcolor: '#0F1115',
        font: {color: '#EAEAEA'},
        xaxis: {title: 'Year'},
        yaxis: {title: 'Average Pit Stop Duration (seconds)'},
        hovermode: 'x unified'
    }, {responsive: true});

    // Overtaking Difficulty
    var overtakingData = [{
        values: [12, 88],
        labels: ['Overtakes', 'No Change'],
        type: 'pie',
        marker: {
            colors: ['#2ECC71', '#8A8A8A']
        },
        textinfo: 'label+percent',
        hole: 0.4
    }];

    Plotly.newPlot('overtakingChart', overtakingData, {
        template: 'plotly_dark',
        paper_bgcolor: '#161A20',
        plot_bgcolor: '#0F1115',
        font: {color: '#EAEAEA'},
        showlegend: false,
        height: 250
    }, {responsive: true});

    // Weather Impact
    var weatherData = [{
        values: [73, 18, 9],
        labels: ['Dry', 'Mixed', 'Wet'],
        type: 'pie',
        marker: {
            colors: ['#F5C542', '#1F6AE1', '#2ECC71']
        },
        textinfo: 'label+percent'
    }];

    Plotly.newPlot('weatherImpactChart', weatherData, {
        template: 'plotly_dark',
        paper_bgcolor: '#161A20',
        plot_bgcolor: '#0F1115',
        font: {color: '#EAEAEA'},
        showlegend: false,
        height: 300
    }, {responsive: true});
</script>
{% endblock %}
